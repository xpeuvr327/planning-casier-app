<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Semaine de Base</title>
    <link href="styles.css" rel="stylesheet">
    <link href="https://unpkg.com/franken-ui@2.0.0/dist/css/core.min.css" rel="stylesheet">
    <script src="https://unpkg.com/franken-ui@2.0.0/dist/js/core.iife.js" type="module"></script>
    <script src="https://unpkg.com/franken-ui@2.0.0/dist/js/icon.iife.js" type="module"></script>
    <link href="https://unpkg.com/franken-ui@internal/dist/css/core.min.css" rel="stylesheet">
    <link href="https://unpkg.com/franken-ui@internal/dist/css/utilities.min.css" rel="stylesheet">
    <script src="https://unpkg.com/@tailwindcss/browser@4"></script>
</head>
<body>
<div style="text-align:center">
    <h1 class="font-bold text-3xl">Semaine de Base</h1>
</div>
<p class="p-4">Cette page sert à créer l'horaire sur lequel l'appli se basera.</p>
<div class="container">
    <div class="header">
        <span id="monthSpace"></span>
    </div>
    <table class="planner-table" id="planner"></table>
    <br>
    <input accept=".json" class="upload-input" id="uploadJson" type="file">
    <label class="custom-file-upload" for="uploadJson" tabindex="0">Choisir un fichier de Planning</label>
    <button class="action-button" id="downloadUpdatedJson">Télécharger le planning tel qu'on le voit (va aller dans "choisir un fichier planning")</button>
</div>
<script src="main.js"></script>
<script>
    function createTableHeaders(table, days) {
        const headerRow = document.createElement("tr");
        const header = document.createElement("th");
        header.textContent = "Heure/Jour";
        headerRow.appendChild(header);
        days.forEach(day => {
            const header = document.createElement("th");
            header.textContent = day;
            headerRow.appendChild(header);
        });
        table.appendChild(headerRow);
    }

    function initializeWeek0App() {
        const startDate = new Date("2024-08-26");
        const days = ["Lundi", "Mardi", "Mercredi", "Jeudi", "Vendredi"];
        const newWeekDays = [];
        for (let i = 0; i < days.length; i++) {
            const currentDate = new Date(startDate);
            currentDate.setDate(startDate.getDate() + i);
            const monthName = currentDate.toLocaleString("default", { month: "long" });
            newWeekDays.push(`${days[i]} ${currentDate.getDate()}`);
        }
        const schedule = {};
        Object.keys(dayMapping).forEach(dayLetter => {
            schedule[dayLetter] = [];
        });
        const week0Data = { days: newWeekDays, schedule: schedule, totalHours: 11, timeScheme: "default" };
        saveWeekData(0, week0Data);
        displayPlanner(week0Data);
        document.getElementById("uploadJson").addEventListener("change", handleFileUpload);
        document.getElementById("downloadUpdatedJson").addEventListener("click", downloadUpdatedJson);
    }

    function handleFileUpload(event) {
        const file = event.target.files[0];
        if (file) {
            readFile(file);
        }
    }

    function readFile(file) {
        const reader = new FileReader();
        reader.onload = function (e) {
            try {
                const data = JSON.parse(e.target.result);
                saveWeekData(0, data);
                displayPlanner(data);
                UIkit.notification({
                    message: "Données de la semaine sauvegardées avec succès.",
                    status: "success",
                    pos: "top-center",
                    timeout: 3000
                });
            } catch (error) {
                console.error("Error parsing JSON file:", error);
            }
        };
        reader.readAsText(file);
    }

    function saveWeekData(week, data) {
        localStorage.setItem(`week0`, JSON.stringify(data));
    }

    function downloadUpdatedJson() {
        const data = JSON.parse(localStorage.getItem(`week0`));
        const jsonString = `data:text/json;charset=utf-8,${encodeURIComponent(JSON.stringify(data))}`;
        const link = document.createElement("a");
        link.href = jsonString;
        link.download = `week0.json`;
        link.click();
    }

    window.onload = function () {
        initializeWeek0App();
    };

    const dayMapping = { a: "Lundi", b: "Mardi", c: "Mercredi", d: "Jeudi", e: "Vendredi" };

    function displayPlanner(data) {
        const table = document.getElementById("planner");
        table.innerHTML = "";
        if (!data.days) {
            data.days = generateNewWeekData(0).days;
        }
        createTableHeaders(table, data.days);
        createTableData(table, data);
        if (data.timeScheme) {
            fetchTimeScheme(data.timeScheme);
        }
    }

    function createTableData(table, data) {
        let totalHours = data.totalHours;
        if (totalHours === undefined || totalHours === null || isNaN(totalHours)) {
            totalHours = 11;
        } else {
            totalHours = Math.floor(Number(totalHours));
        }
        for (let i = 0; i < totalHours; i++) {
            const row = document.createElement("tr");
            const cell = document.createElement("td");
            cell.textContent = `Heure ${i + 1}`;
            row.appendChild(cell);
            data.days.forEach(day => {
                const dayLetter = reverseDayMapping[day.split(" ")[0]];
                const cell = document.createElement("td");
                cell.id = `${dayLetter}${i + 1}`;
                if (data.schedule[dayLetter]) {
                    const event = data.schedule[dayLetter].find(e => e.period === i + 1);
                    if (event) {
                        let cellContent = `${event.subject} - ${event.notes}`;
                        if (event.homework && event.homework.length > 0) {
                            cellContent += `<div class="uk-margin-small-top">`;
                            event.homework.forEach(hw => {
                                cellContent += `<span class="uk-badge uk-background-secondary homework-badge"
                                                   data-day="${dayLetter}"
                                                   data-period="${i + 1}"
                                                   data-id="${hw.id}">${hw.title}</span> `;
                            });
                            cellContent += `</div>`;
                        }
                        cell.innerHTML = cellContent;
                    }
                }
                addCellClickListener(cell, dayLetter, i + 1, data);
                row.appendChild(cell);
            });
            table.appendChild(row);
        }
    }

    function fetchTimeScheme(timeScheme) {
        fetch(`data/time${timeScheme}.json`)
            .then(response => {
                if (!response.ok) {
                    throw new Error("Network response was not ok " + response.statusText);
                }
                return response.json();
            })
            .then(timeData => {
                displayTimeData(timeData);
            })
            .catch(error => {
                console.error("There has been a problem with your fetch operation:", error);
            });
    }

    function displayTimeData(timeData) {
        for (let i = 0; i < timeData.times.length; i++) {
            const heureCell = document.querySelector(`tr:nth-child(${i + 2}) td:first-child`);
            if (heureCell && !heureCell.dataset.timeAdded) {
                heureCell.innerHTML += `<br>${timeData.times[i].start} - ${timeData.times[i].end}`;
                heureCell.setAttribute("data-time-added", "true");
            }
        }
    }

    function addCellClickListener(cell, dayLetter, period, data) {
        cell.addEventListener("click", () => {
            const event = data.schedule[dayLetter]?.find(e => e.period === period);
            if (event) {
                showCellOptionsMenu(cell, dayLetter, period, data, event);
            } else {
                createNewEvent(dayLetter, period, data);
            }
        });
    }

    function createNewEvent(dayLetter, period, data) {
        selectSubject()
            .then(subject => {
                if (subject && subject !== "Veuillez choisir une option") {
                    return promptForNotes().then(notes => ({ subject: subject, notes: notes }));
                }
                throw new Error("No subject provided or invalid selection");
            })
            .then(({ subject, notes }) => {
                if (notes) {
                    createOrUpdateEvent(dayLetter, period, subject, notes, data);
                    const isOddPeriod = period % 2 !== 0 && period !== 5 && period !== 11;
                    if (isOddPeriod) {
                        const nextPeriod = period + 1;
                        if (nextPeriod <= data.totalHours) {
                            copyCell(`${dayLetter}${period}`, `${dayLetter}${nextPeriod}`, data);
                        }
                    } else {
                        UIkit.modal.confirm("Ce cours dure t-il les deux heures?")
                            .then(() => {
                                const nextPeriod = period + 1;
                                if (nextPeriod <= data.totalHours) {
                                    copyCell(`${dayLetter}${period}`, `${dayLetter}${nextPeriod}`, data);
                                }
                            })
                            .catch(() => { });
                    }
                } else {
                    throw new Error("No notes provided");
                }
            })
            .catch(error => {
                console.error(error.message);
            });
    }

    function showCellOptionsMenu(cell, dayLetter, period, data, event) {
        const modalContainer = document.createElement("div");
        let homeworkListHtml = "";
        if (event.homework && event.homework.length > 0) {
            homeworkListHtml = `
            <div class="uk-margin-medium-top">
                <h3>Devoirs</h3>
                <ul class="uk-list uk-list-divider">
                    ${event.homework.map(hw => `<li><a href="#" class="homework-item" data-homework-id="${hw.id}">${hw.title}</a></li>`).join("")}
                </ul>
            </div>
        `;
        }
        modalContainer.innerHTML = `
        <div class="uk-modal-dialog uk-modal-body uk-margin-auto-vertical">
            <h2 class="uk-modal-title">${event.subject} - ${event.notes}</h2>
            ${homeworkListHtml}
            <div class="uk-grid-small uk-child-width-1-1 uk-grid uk-margin-medium-top">
                <div>
                    <button id="btn-modify" class="uk-button uk-button-primary uk-width-1-1">Modifier</button>
                </div>
                <div>
                    <button id="btn-add-homework" class="uk-button uk-button-secondary uk-width-1-1">Ajouter un devoir</button>
                </div>
                <div>
                    <button id="btn-delete" class="uk-button uk-button-danger uk-width-1-1">Supprimer</button>
                </div>
                <div>
                    <button class="uk-button uk-button-default uk-modal-close uk-width-1-1">Annuler</button>
                </div>
            </div>
        </div>
    `;
        const modal = UIkit.modal(modalContainer, { bgClose: true, center: true });
        modal.show();
        modalContainer.querySelector("#btn-modify").addEventListener("click", () => {
            modal.hide();
            modifyEvent(cell, dayLetter, period, data, event);
        });
        modalContainer.querySelector("#btn-delete").addEventListener("click", () => {
            modal.hide();
            UIkit.modal.confirm("Êtes-vous sûr de vouloir supprimer cet événement?")
                .then(() => {
                    deleteEvent(dayLetter, period, data);
                })
                .catch(() => { });
        });
        const homeworkItems = modalContainer.querySelectorAll(".homework-item");
        homeworkItems.forEach(item => {
            item.addEventListener("click", e => {
                e.preventDefault();
                const homeworkId = item.getAttribute("data-homework-id");
                const homework = event.homework.find(hw => hw.id === homeworkId);
                if (homework) {
                    showHomeworkDetails(homework, dayLetter, period, data, event);
                }
            });
        });
    }

    function showHomeworkDetails(homework, dayLetter, period, data, event) {
        const modalContainer = document.createElement("div");
        modalContainer.innerHTML = `
        <div class="uk-modal-dialog uk-modal-body uk-margin-auto-vertical">
            <button class="uk-modal-close-default" type="button" uk-close></button>
            <h2 class="uk-modal-title">${homework.title}</h2>
            <div class="uk-margin">
                <div class="uk-alert">${homework.content}</div>
            </div>
            <div class="uk-margin-top uk-text-right">
                <button id="btn-edit-homework" class="uk-button uk-button-primary">Modifier</button>
                <button id="btn-delete-homework" class="uk-button uk-button-danger">Supprimer</button>
                <button class="uk-button uk-button-default uk-modal-close">Fermer</button>
            </div>
        </div>
    `;
        const modal = UIkit.modal(modalContainer, { bgClose: true, center: true });
        modal.show();
        modalContainer.querySelector("#btn-edit-homework").addEventListener("click", () => {
            modal.hide();
            editHomework(homework, dayLetter, period, data, event);
        });
        modalContainer.querySelector("#btn-delete-homework").addEventListener("click", () => {
            modal.hide();
            UIkit.modal.confirm("Êtes-vous sûr de vouloir supprimer ce devoir?")
                .then(() => {
                    deleteHomework(homework.id, dayLetter, period, data);
                })
                .catch(() => { });
        });
    }

    function deleteHomework(homeworkId, dayLetter, period, data) {
        const eventIndex = data.schedule[dayLetter].findIndex(e => e.period === period);
        if (eventIndex !== -1 && data.schedule[dayLetter][eventIndex].homework) {
            data.schedule[dayLetter][eventIndex].homework = data.schedule[dayLetter][eventIndex].homework.filter(hw => hw.id !== homeworkId);
            saveWeekData(currentWeek, data);
            displayPlanner(data);
        }
    }

    function editHomework(homework, dayLetter, period, data, event, callback) {
        const modalContainer = document.createElement("div");
        modalContainer.innerHTML = `
        <div class="uk-modal-dialog uk-modal-body uk-margin-auto-vertical">
            <h2 class="uk-modal-title">Modifier le devoir</h2>
            <form class="uk-form-stacked">
                <div class="uk-margin">
                    <label class="uk-form-label" for="homework-title">Titre</label>
                    <div class="uk-form-controls">
                        <input id="homework-title" class="uk-input" type="text" value="${homework.title}">
                    </div>
                </div>
                <div class="uk-margin">
                    <label class="uk-form-label" for="homework-content">Contenu</label>
                    <div class="uk-form-controls">
                        <textarea id="homework-content" class="uk-textarea" rows="5">${homework.content}</textarea>
                    </div>
                </div>
                <div class="uk-margin uk-text-right">
                    <button type="button" class="uk-button uk-button-default uk-modal-close">Annuler</button>
                    <button type="button" id="btn-update-homework" class="uk-button uk-button-primary">Mettre à jour</button>
                </div>
            </form>
        </div>
    `;
        const modal = UIkit.modal(modalContainer, { bgClose: false, center: true });
        modal.show();
        modalContainer.querySelector("#btn-update-homework").addEventListener("click", () => {
            const title = modalContainer.querySelector("#homework-title").value.trim();
            const content = modalContainer.querySelector("#homework-content").value.trim();
            if (title && content) {
                const eventIndex = data.schedule[dayLetter].findIndex(e => e.period === period);
                if (eventIndex !== -1 && data.schedule[dayLetter][eventIndex].homework) {
                    const homeworkIndex = data.schedule[dayLetter][eventIndex].homework.findIndex(hw => hw.id === homework.id);
                    if (homeworkIndex !== -1) {
                        data.schedule[dayLetter][eventIndex].homework[homeworkIndex].title = title;
                        data.schedule[dayLetter][eventIndex].homework[homeworkIndex].content = content;
                        const weekNumber = parseInt(currentWeek, 10);
                        saveWeekData(weekNumber, data);
                        displayPlanner(data);
                        modal.hide();
                        if (typeof callback === "function") {
                            callback();
                        }
                    }
                }
            } else {
                UIkit.notification({
                    message: "Veuillez remplir tous les champs",
                    status: "danger",
                    pos: "top-center",
                    timeout: 3000
                });
            }
        });
    }

    function deleteEvent(dayLetter, period, data) {
        if (data.schedule[dayLetter]) {
            const eventIndex = data.schedule[dayLetter].findIndex(e => e.period === period);
            if (eventIndex !== -1) {
                data.schedule[dayLetter].splice(eventIndex, 1);
                saveWeekData(currentWeek, data);
                displayPlanner(data);
            }
        }
    }

    function selectSubject(defaultSubject = "") {
        return new Promise((resolve, reject) => {
            let subjects = [];
            const collegeYear = localStorage.getItem("collegeYear");
            const defaultSubjects = [
                { label: "Veuillez choisir une option", options: ["Veuillez choisir une option"] },
                { label: "Sélection", options: ["Français", "Math"] },
                { label: "Sciences", options: ["Math", "Info", "Physique", "Bio", "Chimie"] },
                { label: "Langues", options: ["Français", "Allemand", "Italien", "Anglais", "Espagnol", "Latin", "Grec"] },
                { label: "Général", options: ["Histoire", "Droit", "Éco", "Sport"] },
                { label: "Arts", options: ["Arts visuels", "Histoire de l'art", "Musique"] }
            ];
            if (collegeYear == 1 || collegeYear == 2 || collegeYear == 3 || collegeYear == 4) {
                subjects = defaultSubjects;
            } else {
                subjects = defaultSubjects;
            }
            subjects.push({ label: "Autre", options: ["Autre"] });
            const modalContainer = document.createElement("div");
            modalContainer.innerHTML = `
            <div class="uk-modal-dialog uk-modal-body uk-margin-auto-vertical">
                <h2 class="uk-modal-title">Choisissez la matière</h2>
                <select id="subject-select" class="uk-select">
                    ${subjects.map(group => `
                        <optgroup label="${group.label}">
                            ${group.options.map(option => `<option value="${option}" ${option === defaultSubject ? "selected" : ""}>${option}</option>`).join("")}
                        </optgroup>
                    `).join("")}
                </select>
                <div id="other-subject-container" class="uk-margin" style="display: none;">
                    <label class="p-0" for="other-subject">Autre matière:</label>
                    <div class="uk-form-controls">
                        <input id="other-subject" class="uk-input" type="text" placeholder="Entrez le nom de la matière">
                    </div>
                </div>
                <p class="uk-text-right">
                    <button class="uk-button uk-button-default uk-modal-close" type="button">Annuler</button>
                    <button class="uk-button uk-button-primary" type="button">Confirmer</button>
                </p>
            </div>
        `;
            const modal = UIkit.modal(modalContainer, { bgClose: false, center: true });
            modal.show();
            const selectElement = modalContainer.querySelector("#subject-select");
            const otherSubjectContainer = modalContainer.querySelector("#other-subject-container");
            const otherSubjectInput = modalContainer.querySelector("#other-subject");
            selectElement.addEventListener("change", () => {
                if (selectElement.value === "Autre") {
                    otherSubjectContainer.style.display = "block";
                } else {
                    otherSubjectContainer.style.display = "none";
                }
            });
            if (selectElement.value === "Autre") {
                otherSubjectContainer.style.display = "block";
            }
            modalContainer.querySelector(".uk-button-primary").addEventListener("click", () => {
                const selectedValue = selectElement.value;
                if (selectedValue === "Autre") {
                    const customSubject = otherSubjectInput.value.trim();
                    if (customSubject) {
                        resolve(customSubject);
                    } else {
                        UIkit.notification({
                            message: "Veuillez entrer le nom de la matière",
                            status: "danger",
                            timeout: 3000
                        });
                        return;
                    }
                } else if (selectedValue === "Veuillez choisir une option") {
                    UIkit.notification({
                        message: "Veuillez sélectionner une matière",
                        status: "danger",
                        timeout: 3000
                    });
                    return;
                } else {
                    resolve(selectedValue);
                }
                modal.hide();
            });
            modalContainer.querySelector(".uk-modal-close").addEventListener("click", () => {
                reject(new Error("Subject selection cancelled"));
                modal.hide();
            });
            modal.$destroy = true;
        });
    }

    function modifyEvent(cell, dayLetter, period, data, event) {
        selectSubject(event.subject)
            .then(subject => {
                if (subject) {
                    return promptForNotes(event.notes).then(notes => ({ subject: subject, notes: notes }));
                }
                throw new Error("No subject provided");
            })
            .then(({ subject, notes }) => {
                if (notes) {
                    createOrUpdateEvent(dayLetter, period, subject, notes, data);
                    UIkit.modal.confirm("Ce cours dure t-il les deux heures?")
                        .then(() => {
                            const nextPeriod = period + 1;
                            if (nextPeriod <= 11) {
                                copyCell(`${dayLetter}${period}`, `${dayLetter}${nextPeriod}`, data);
                            }
                        })
                        .catch(() => { });
                } else {
                    throw new Error("No notes provided");
                }
            })
            .catch(error => {
                console.error(error.message);
            });
    }

    function promptForNotes(defaultNotes = "") {
        return UIkit.modal.prompt("Entre la salle: ", defaultNotes);
    }

    function copyCell(copyFrom, copyTo, data) {
        console.log("copyCell function triggered");
        const fromDayLetter = copyFrom[0];
        const fromPeriod = parseInt(copyFrom.slice(1), 10);
        const toDayLetter = copyTo[0];
        const toPeriod = parseInt(copyTo.slice(1), 10);
        console.log(`Copying from ${fromDayLetter}${fromPeriod} to ${toDayLetter}${toPeriod}`);
        console.log("Current schedule:", data.schedule);
        const fromDay = data.schedule[fromDayLetter];
        if (!fromDay) {
            console.error(`No schedule found for day ${fromDayLetter}`);
            return;
        }
        const eventToCopy = fromDay.find(e => e.period === fromPeriod);
        if (!eventToCopy) {
            console.error(`No event found for period ${fromPeriod} on day ${fromDayLetter}`);
            return;
        }
        console.log("Event to copy:", eventToCopy);
        if (!data.schedule[toDayLetter]) {
            data.schedule[toDayLetter] = [];
        }
        const existingEventIndex = data.schedule[toDayLetter].findIndex(e => e.period === toPeriod);
        if (existingEventIndex !== -1) {
            data.schedule[toDayLetter].splice(existingEventIndex, 1);
        }
        const newEvent = { period: toPeriod, subject: eventToCopy.subject, notes: eventToCopy.notes };
        data.schedule[toDayLetter].push(newEvent);
        saveWeekData(currentWeek, data);
        displayPlanner(data);
    }

    function createOrUpdateEvent(dayLetter, period, subject, notes, data) {
        const event = { period: period, subject: subject, notes: notes };
        if (!data.schedule[dayLetter]) {
            data.schedule[dayLetter] = [];
        }
        const eventIndex = data.schedule[dayLetter].findIndex(e => e.period === event.period);
        if (eventIndex !== -1) {
            data.schedule[dayLetter][eventIndex] = event;
        } else {
            data.schedule[dayLetter].push(event);
        }
        saveWeekData(currentWeek, data);
        console.log(`Event created/updated for week ${currentWeek}:`, data);
        displayPlanner(data);
    }

    function generateNewWeekData(week) {
        const startDate = new Date("2024-08-26");
        startDate.setDate(startDate.getDate() + (week - 1) * 7);
        const days = ["Lundi", "Mardi", "Mercredi", "Jeudi", "Vendredi"];
        const newWeekDays = [];
        for (let i = 0; i < days.length; i++) {
            const currentDate = new Date(startDate);
            currentDate.setDate(startDate.getDate() + i);
            const monthName = currentDate.toLocaleString("default", { month: "long" });
            newWeekDays.push(`${days[i]} ${currentDate.getDate()}`);
        }
        const schedule = {};
        Object.keys(dayMapping).forEach(dayLetter => {
            schedule[dayLetter] = [];
        });
        return { days: newWeekDays, schedule: schedule, totalHours: 11, timeScheme: "default" };
    }

    const reverseDayMapping = Object.fromEntries(Object.entries(dayMapping).map(([key, value]) => [value, key]));

    function populateWeekSelector() {
        const selectElement = document.getElementById("weekSelect");
        selectElement.innerHTML = "";
        const defaultOption = document.createElement("option");
        defaultOption.value = "";
        defaultOption.textContent = "Choisissez une semaine";
        selectElement.appendChild(defaultOption);
        const weekNumbers = [];
        for (let i = 0; i < localStorage.length; i++) {
            const key = localStorage.key(i);
            if (key.startsWith("week")) {
                const weekNumber = parseInt(key.replace("week", ""), 10);
                if (!isNaN(weekNumber)) {
                    weekNumbers.push(weekNumber);
                }
            }
        }
        weekNumbers.sort((a, b) => a - b);
        weekNumbers.forEach(weekNumber => {
            const option = document.createElement("option");
            option.value = weekNumber;
            option.textContent = `Semaine ${weekNumber}`;
            selectElement.appendChild(option);
        });
        const urlParams = new URLSearchParams(window.location.search);
        const weekParam = urlParams.get("week");
        if (weekParam) {
            selectElement.value = weekParam;
        }
        selectElement.addEventListener("change", handleWeekSelection);
    }

    function handleWeekSelection() {
        const selectElement = document.getElementById("weekSelect");
        const selectedWeek = selectElement.value;
        if (selectedWeek) {
            const newUrl = new URL(window.location);
            newUrl.searchParams.set("week", selectedWeek);
            window.history.pushState({}, "", newUrl);
            currentWeek = parseInt(selectedWeek, 10);
            if (!isNaN(currentWeek)) {
                populateWeekSelector();
                loadWeek(selectedWeek);
            }
        }
    }

    function loadWeek(week) {
        const data = getWeekData(week);
        if (data) {
            displayPlanner(data);
        } else {
            duplicateWeekWithoutHomework(0, week);
            const newWeekData = getWeekData(week);
            displayPlanner(newWeekData);
        }
    }

    function getWeekData(week) {
        const data = localStorage.getItem(`week${week}`);
        return data ? JSON.parse(data) : null;
    }

    function duplicateWeekWithoutHomework(sourceWeek, targetWeek) {
        const sourceWeekData = getWeekData(sourceWeek);
        if (sourceWeekData) {
            const newWeekData = JSON.parse(JSON.stringify(sourceWeekData));
            newWeekData.schedule = Object.keys(newWeekData.schedule).reduce((acc, dayLetter) => {
                acc[dayLetter] = newWeekData.schedule[dayLetter].map(event => ({ ...event, homework: [] }));
                return acc;
            }, {});
            saveWeekData(targetWeek, newWeekData);
        }
    }
</script>
</body>
</html>
